<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<title>Class bandwidthThrottle\tokenBucket\TokenBucket</title>

	<link rel="stylesheet" href="resources/style.css?95ada9fb523b6ab4fd1c47bb375f713f2cc65542">

</head>

<body>
<div id="left">
	<div id="menu">
		<a href="index.html" title="Overview"><span>Overview</span></a>


		<div id="groups">
				<h3>Namespaces</h3>
			<ul>
				<li class="active">
					<a href="namespace-bandwidthThrottle.html">
						bandwidthThrottle<span></span>
					</a>

						<ul>
				<li class="active">
					<a href="namespace-bandwidthThrottle.tokenBucket.html">
						tokenBucket<span></span>
					</a>

						<ul>
				<li>
					<a href="namespace-bandwidthThrottle.tokenBucket.lock.html">
						lock					</a>

						</li>
				<li>
					<a href="namespace-bandwidthThrottle.tokenBucket.storage.html">
						storage<span></span>
					</a>

						<ul>
				<li>
					<a href="namespace-bandwidthThrottle.tokenBucket.storage.scope.html">
						scope					</a>

						</li>
							</ul></li></ul></li></ul></li>
			</ul>
		</div>

		<hr>


		<div id="elements">
			<h3>Classes</h3>
			<ul>
				<li><a href="class-bandwidthThrottle.tokenBucket.BlockingConsumer.html">BlockingConsumer</a></li>
				<li><a href="class-bandwidthThrottle.tokenBucket.Rate.html">Rate</a></li>
				<li class="active"><a href="class-bandwidthThrottle.tokenBucket.TokenBucket.html">TokenBucket</a></li>
			</ul>



			<h3>Exceptions</h3>
			<ul>
				<li><a href="class-bandwidthThrottle.tokenBucket.TokenBucketException.html">TokenBucketException</a></li>
			</ul>


		</div>
	</div>
</div>

<div id="splitter"></div>

<div id="right">
<div id="rightInner">
	<form id="search">
		<input type="hidden" name="cx" value="">
		<input type="hidden" name="ie" value="UTF-8">
		<input type="text" name="q" class="text" placeholder="Search">
	</form>

	<div id="navigation">
		<ul>
			<li>
				<a href="index.html" title="Overview"><span>Overview</span></a>
			</li>
			<li>
				<a href="namespace-bandwidthThrottle.tokenBucket.html" title="Summary of bandwidthThrottle\tokenBucket"><span>Namespace</span></a>
			</li>
			<li class="active">
<span>Class</span>			</li>
		</ul>
		<ul>
		</ul>
		<ul>
		</ul>
	</div>

<div id="content" class="class">
	<h1>Class TokenBucket</h1>


	<div class="description">
	<p>Token Bucket algorithm.</p>

<p>The token bucket algorithm can be used for controlling the usage rate
of a resource. The scope of that rate is determined by the underlying
storage.</p>

<p>Example:</p>

<pre><span class="php-keyword1">use</span> bandwidthThrottle\tokenBucket\Rate;
<span class="php-keyword1">use</span> bandwidthThrottle\tokenBucket\TokenBucket;
<span class="php-keyword1">use</span> bandwidthThrottle\tokenBucket\storage\FileStorage;

<span class="php-var">$storage</span> = <span class="php-keyword1">new</span> FileStorage(__DIR__ . <span class="php-quote">&quot;/api.bucket&quot;</span>);
<span class="php-var">$rate</span>    = <span class="php-keyword1">new</span> Rate(<span class="php-num">10</span>, Rate::SECOND);
<span class="php-var">$bucket</span>  = <span class="php-keyword1">new</span> TokenBucket(<span class="php-num">10</span>, <span class="php-var">$rate</span>, <span class="php-var">$storage</span>);
<span class="php-var">$bucket</span>-&gt;bootstrap(<span class="php-num">10</span>);

<span class="php-keyword1">if</span> (!<span class="php-var">$bucket</span>-&gt;consume(<span class="php-num">1</span>, <span class="php-var">$seconds</span>)) {
    <span class="php-keyword2">http_response_code</span>(<span class="php-num">429</span>);
    <span class="php-keyword2">header</span>(<span class="php-keyword2">sprintf</span>(<span class="php-quote">&quot;Retry-After: %d&quot;</span>, <span class="php-keyword2">floor</span>(<span class="php-var">$seconds</span>)));
    <span class="php-keyword1">exit</span>();
}</pre>
	</div>









	<div class="info">
		
		
		<b>Namespace:</b> <a href="namespace-bandwidthThrottle.html">bandwidthThrottle</a>\<a href="namespace-bandwidthThrottle.tokenBucket.html">tokenBucket</a><br>
		

				<b>License:</b>
				<a href="WTFPL">WTFPL</a><br>
				<b>Author:</b>
				Markus Malkusch <a href="&#109;&#97;&#105;&#108;&#116;&#x6f;&#x3a;&#x6d;&#x61;&#114;&#107;&#117;&#115;&#64;&#x6d;&#x61;&#x6c;&#x6b;u&#115;&#99;&#104;&#46;&#x64;&#x65;">&#x6d;&#x61;&#114;&#107;&#117;&#115;&#64;&#x6d;&#x61;&#x6c;&#x6b;u&#115;&#99;&#104;&#46;&#x64;&#x65;</a><br>
				<b>Link:</b>
				<a href="bitcoin:1335STSwu9hST4vcMRppEPgENMHD2r1REK">Donations</a><br>
			<b>Located at</b> <a href="source-class-bandwidthThrottle.tokenBucket.TokenBucket.html#11-213" title="Go to source code">TokenBucket.php</a>
		<br>
	</div>



	<table class="summary methods" id="methods">
	<caption>Methods summary</caption>
	<tr data-order="__construct" id="___construct">

		<td class="attributes"><code>
			 public 

			
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#___construct">#</a>
		<code><a href="source-class-bandwidthThrottle.tokenBucket.TokenBucket.html#78-96" title="Go to source code">__construct</a>( <span>integer <var>$capacity</var></span>, <span><code><a href="class-bandwidthThrottle.tokenBucket.Rate.html">bandwidthThrottle\tokenBucket\Rate</a></code> <var>$rate</var></span>, <span><code><a href="class-bandwidthThrottle.tokenBucket.storage.Storage.html">bandwidthThrottle\tokenBucket\storage\Storage</a></code> <var>$storage</var></span> )</code>

		<div class="description short">
			<p>Initializes the Token bucket.</p>
		</div>

		<div class="description detailed hidden">
			<p>Initializes the Token bucket.</p>

<p>The storage determines the scope of the bucket.</p>


				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$capacity</var></dt>
					<dd>Capacity of the bucket.</dd>
					<dt><var>$rate</var></dt>
					<dd>The rate.</dd>
					<dt><var>$storage</var></dt>
					<dd>The storage.</dd>
				</dl></div>





		</div>
		</div></td>
	</tr>
	<tr data-order="bootstrap" id="_bootstrap">

		<td class="attributes"><code>
			 public 

			
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#_bootstrap">#</a>
		<code><a href="source-class-bandwidthThrottle.tokenBucket.TokenBucket.html#98-130" title="Go to source code">bootstrap</a>( <span>integer <var>$tokens</var> = <span class="php-num">0</span></span> )</code>

		<div class="description short">
			<p>Bootstraps the storage with an initial amount of tokens.</p>
		</div>

		<div class="description detailed hidden">
			<p>Bootstraps the storage with an initial amount of tokens.</p>

<p>If the storage was already bootstrapped this method returns silently.</p>

<p>While you could call bootstrap() on each request, you should not do that!
This method will do unnecessary storage communications just to see that
bootstrapping was performed already. You therefore should call that
method in your application's bootstrap or deploy process.</p>

<p>This method is threadsafe.</p>


				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$tokens</var></dt>
					<dd>Initial amount of tokens, default is 0.</dd>
				</dl></div>


				<h4>Throws</h4>
				<div class="list">
					<code><a href="class-bandwidthThrottle.tokenBucket.storage.StorageException.html">bandwidthThrottle\tokenBucket\storage\StorageException</a></code><br>Bootstrapping failed.<br>
					LengthException<br>The initial amount of tokens is larger than the capacity.
				</div>



		</div>
		</div></td>
	</tr>
	<tr data-order="consume" id="_consume">

		<td class="attributes"><code>
			 public 

			boolean
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#_consume">#</a>
		<code><a href="source-class-bandwidthThrottle.tokenBucket.TokenBucket.html#132-179" title="Go to source code">consume</a>( <span>integer <var>$tokens</var></span>, <span>float <var>&amp; $seconds</var> = <span class="php-num">0</span></span> )</code>

		<div class="description short">
			<p>Consumes tokens from the bucket.</p>
		</div>

		<div class="description detailed hidden">
			<p>Consumes tokens from the bucket.</p>

<p>This method consumes only tokens if there are sufficient tokens available.
If there aren't sufficient tokens, no tokens will be removed and the
remaining seconds to wait is written to $seconds.</p>


				<h4>Parameters</h4>
				<div class="list"><dl>
					<dt><var>$tokens</var></dt>
					<dd>The token amount.</dd>
					<dt><var>$seconds</var></dt>
					<dd>$seconds The seconds to wait.</dd>
				</dl></div>

				<h4>Returns</h4>
				<div class="list">
					boolean<br>If tokens were consumed.
				</div>

				<h4>Throws</h4>
				<div class="list">
					LengthException<br>The token amount is larger than the capacity.<br>
					<code><a href="class-bandwidthThrottle.tokenBucket.storage.StorageException.html">bandwidthThrottle\tokenBucket\storage\StorageException</a></code><br>The stored microtime could not be accessed.
				</div>

				<h4>Suppresswarnings(phpmd)</h4>
				<div class="list">
				</div>


		</div>
		</div></td>
	</tr>
	<tr data-order="getRate" id="_getRate">

		<td class="attributes"><code>
			 public 

			<code><a href="class-bandwidthThrottle.tokenBucket.Rate.html">bandwidthThrottle\tokenBucket\Rate</a></code>
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#_getRate">#</a>
		<code><a href="source-class-bandwidthThrottle.tokenBucket.TokenBucket.html#181-189" title="Go to source code">getRate</a>( )</code>

		<div class="description short">
			<p>Returns the token add rate.</p>
		</div>

		<div class="description detailed hidden">
			<p>Returns the token add rate.</p>



				<h4>Returns</h4>
				<div class="list">
					<code><a href="class-bandwidthThrottle.tokenBucket.Rate.html">bandwidthThrottle\tokenBucket\Rate</a></code><br>The rate.
				</div>




		</div>
		</div></td>
	</tr>
	<tr data-order="getCapacity" id="_getCapacity">

		<td class="attributes"><code>
			 public 

			integer
			
			</code>
		</td>

		<td class="name"><div>
		<a class="anchor" href="#_getCapacity">#</a>
		<code><a href="source-class-bandwidthThrottle.tokenBucket.TokenBucket.html#191-199" title="Go to source code">getCapacity</a>( )</code>

		<div class="description short">
			<p>The token capacity of this bucket.</p>
		</div>

		<div class="description detailed hidden">
			<p>The token capacity of this bucket.</p>



				<h4>Returns</h4>
				<div class="list">
					integer<br>The capacity.
				</div>




		</div>
		</div></td>
	</tr>
	</table>


















</div>

	<div id="footer">
		 API documentation generated by <a href="http://apigen.org">ApiGen</a>
	</div>
</div>
</div>
<script src="resources/combined.js"></script>
<script src="elementlist.js"></script>
</body>
</html>
